<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CEORater â€“ NASDAQ 100 CEO Rankings</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-6">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
      <div>
        <h1 class="text-4xl font-bold text-gray-900">CEORater</h1>
        <p class="text-gray-600 mt-1">NASDAQ 100 CEO Rankings & Performance Dashboard</p>
      </div>
      <div class="mt-4 md:mt-0 flex items-center text-sm text-gray-500">
        <span class="w-2 h-2 animate-pulse rounded-full bg-green-500 mr-2"></span>
        Updated <span id="lastUpdated" class="font-semibold">just now</span>
      </div>
    </header>

    <nav id="filterTabs" class="mb-6 border-b border-gray-200 flex space-x-6 overflow-x-auto text-sm">
      <button data-filter="all" class="pb-2 border-b-2 border-purple-600 text-purple-600 font-semibold">All CEOs</button>
      <button data-filter="top" class="pb-2 text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Top Performers</button>
      <button data-filter="ownership" class="pb-2 text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">High Ownership</button>
      <button data-filter="insider" class="pb-2 text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Recent Insider Buys</button>
      <button data-filter="flags" class="pb-2 text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent">Red Flags</button>
    </nav>

    <div class="overflow-x-auto bg-white shadow rounded-lg">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Rank</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">CEO & Company</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Tenure</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Returns</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Ownership</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Insider Score</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Recent Media</th>
            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Total Score</th>
          </tr>
        </thead>
        <tbody id="ceoTableBody" class="divide-y divide-gray-200 odd:bg-white even:bg-gray-50 hover:bg-gray-100">
          <!-- Data rows populated via Supabase JS -->
        </tbody>
      </table>
    </div>

    <footer class="mt-8 text-center text-xs text-gray-500">
      <p>Methodology: weighted blend of returns, tenure, ownership & insider activity.</p>
      <div class="flex justify-center items-center space-x-4 mt-2">
        <span>Data Sources:</span>
        <span class="font-semibold">Supabase</span>
        <span class="font-semibold">YouTube API</span>
      </div>
    </footer>
  </div>

  <script>
    // Initialize Supabase client
    // TODO: Replace these with your Supabase project credentials
const SUPABASE_URL = 'https://qxnljpbxhugsawinluwq.supabase.co';  
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF4bmxqcGJ4aHVnc2F3aW5sdXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwMTE2NjksImV4cCI6MjA2NTU4NzY2OX0.t1aG1JNeuanoOXKcs4CXLQALmLZiWCbdl9ICH2GVRu0';
    
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // DOM shortcuts
    const tbody = document.getElementById('ceoTableBody');
    const filterTabs = document.getElementById('filterTabs');
    const lastUpdated = document.getElementById('lastUpdated');

    let allRows = [];
    let activeFilter = 'all';

    // Helper functions
    const pct = v => v !== null ? `${v.toFixed(2)}%` : 'N/A';
    const tenure = d => {
      if (!d) return 'N/A';
      const start = new Date(d);
      const now = new Date();
      let yrs = now.getFullYear() - start.getFullYear();
      let mos = now.getMonth() - start.getMonth();
      if (mos < 0) { yrs--; mos += 12; }
      return `${yrs} yrs, ${mos} mo`;
    };

    // Render table rows
    function renderTable() {
      tbody.innerHTML = '';
      allRows
        .filter(r => {
          if (activeFilter === 'all') return true;
          if (activeFilter === 'top') return r.total_score >= 80;
          if (activeFilter === 'ownership') return r.equity_ownership_pct > 1;
          if (activeFilter === 'insider') return r.insider_score > 0;
          if (activeFilter === 'flags') return r.insider_score < 0;
          return true;
        })
        .forEach((ceo, i) => {
          const row = document.createElement('tr');
          row.className = i % 2 ? 'bg-gray-50 hover:bg-gray-100' : 'hover:bg-gray-100';
          row.innerHTML = `
            <td class="px-6 py-4">${i+1}</td>
            <td class="px-6 py-4">
              <div class="font-semibold text-gray-900">${ceo.ceo_name}</div>
              <div class="text-gray-500 text-sm">${ceo.company_name} (${ceo.ticker})</div>
            </td>
            <td class="px-6 py-4">${tenure(ceo.ceo_start_date)}</td>
            <td class="px-6 py-4 ${ceo.total_stock_return >= 0 ? 'text-green-600' : 'text-red-600'} font-semibold">${pct(ceo.total_stock_return)}</td>
            <td class="px-6 py-4">${ceo.equity_ownership_pct}%</td>
            <td class="px-6 py-4">
              <div class="w-24 bg-gray-200 rounded-full h-2.5">
                <div class="h-2.5 rounded-full ${ceo.insider_score >= 70 ? 'bg-green-500' : ceo.insider_score >= 40 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${ceo.insider_score}%"></div>
              </div>
            </td>
            <td class="px-6 py-4">
              ${ceo.youtube_urls.length > 0 ? `<button class="text-blue-600 underline text-sm" onclick="showVideos('${ceo.ceo_name}')">View (${ceo.youtube_urls.length})</button>` : '<span class="text-gray-400 text-sm">None</span>'}
            </td>
            <td class="px-6 py-4 font-semibold text-gray-900">${ceo.total_score}</td>
          `;
          tbody.appendChild(row);
        });
    }

    // Fetch data from Supabase
    async function loadData() {
      const { data, error } = await supabase.from('ceo_dim').select('*');
      if (error) {
        console.error('Error fetching data:', error);
        return;
      }
      allRows = data;
      lastUpdated.textContent = new Date().toLocaleString();
      renderTable();
    }

    // Filter tab clicks
    filterTabs.addEventListener('click', e => {
      if (e.target.tagName === 'BUTTON') {
        document.querySelectorAll('#filterTabs button').forEach(b => b.classList.remove('border-purple-600', 'text-purple-600', 'font-semibold'));
        e.target.classList.add('border-purple-600', 'text-purple-600', 'font-semibold');
        activeFilter = e.target.dataset.filter;
        renderTable();
      }
    });

    // Show YouTube videos popup
    function showVideos(name) {
      const ceo = allRows.find(c => c.ceo_name === name);
      if (!ceo) return;
      // implement your popup logic here, similar to previous script
      alert(`Videos for ${name}:\n${ceo.youtube_urls.join('\n')}`);
    }

    // Initial load
    loadData();
  </script>
</body>
</html>
