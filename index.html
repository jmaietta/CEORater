<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEORater</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics and responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Lighter background like the image */
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            padding: 2rem;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 1280px; /* Wider container */
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05); /* Lighter shadow */
            padding: 2.5rem 3rem; /* More generous padding */
        }

        /* Header Styling */
        .header-section h1 {
            color: #2b396b; /* Dark blue from the logo */
            font-size: 3.5rem; /* Larger font for logo */
            font-weight: 800; /* Extra bold */
            letter-spacing: -0.05em; /* Tighter letter spacing */
            line-height: 1;
            margin-bottom: 0.5rem;
        }
        .header-section p {
            color: #64748b; /* Grey for subtitle */
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0; /* Underline for tabs */
            padding-bottom: 0.5rem;
        }
        .nav-tab {
            padding: 0.5rem 1rem;
            font-weight: 600;
            cursor: pointer;
            color: #64748b; /* Inactive tab color */
            transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            border-bottom: 2px solid transparent; /* Placeholder for active underline */
        }
        .nav-tab.active {
            color: #4f46e5; /* Active tab color (indigo) */
            border-color: #4f46e5; /* Active tab underline */
        }
        .nav-tab:hover {
            color: #4f46e5;
        }

        /* Table specific styles */
        table {
            border-collapse: separate; /* Allows for rounded corners on cells */
            border-spacing: 0 0.5rem; /* Space between rows */
            border-radius: 0.75rem; /* Apply to container for overall rounded look */
            overflow: hidden; /* Important for rounded corners to show */
            background-color: transparent; /* Table background handled by container */
        }
        thead {
            background-color: #f8fafc; /* Light header background */
            color: #64748b; /* Header text color */
            font-weight: 600;
            font-size: 0.875rem; /* Smaller header font */
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        th {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: none; /* No border for headers in this design */
            cursor: pointer;
            white-space: nowrap;
        }
        tbody tr {
            background-color: #ffffff;
            border-radius: 0.75rem; /* Rounded corners for each row */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Subtle shadow for rows */
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }
        tbody tr:hover {
            transform: translateY(-2px); /* Slight lift on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        td {
            padding: 1rem 1.5rem;
            border-bottom: none; /* No internal borders in this design */
            vertical-align: middle;
        }
        td:first-child { border-top-left-radius: 0.75rem; border-bottom-left-radius: 0.75rem; }
        td:last-child { border-top-right-radius: 0.75rem; border-bottom-right-radius: 0.75rem; }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .search-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            outline: none;
        }
        .positive-return {
            color: #16a34a; /* Darker green for returns */
            font-weight: bold;
        }
        .negative-return {
            color: #dc2626; /* Darker red for returns */
            font-weight: bold;
        }
        .founder-badge {
            display: inline-block;
            background-color: #fcd34d; /* Yellowish background */
            color: #78350f; /* Dark brown text */
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
            white-space: nowrap;
        }
        .link-text {
            color: #4f46e5; /* Indigo for links */
            text-decoration: none;
            font-weight: 500;
        }
        .link-text:hover {
            text-decoration: underline;
        }
        .icon-arrow {
            width: 1.25rem;
            height: 1.25rem;
            vertical-align: middle;
            fill: none;
            stroke: #64748b;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: transform 0.2s ease-in-out;
        }
        .footer {
            text-align: center;
            margin-top: 3rem;
            font-size: 0.875rem;
            color: #64748b;
        }

        /* Responsive table behavior */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }
            .header-section h1 {
                font-size: 2.5rem;
            }
            .header-section p {
                font-size: 0.9rem;
            }
            .nav-tabs {
                gap: 0.5rem;
            }
            .nav-tab {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tbody tr {
                margin-bottom: 1rem;
            }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
            }
            /* Label the data - reverted to original labels */
            td:nth-of-type(1):before { content: "CEO Name"; }
            td:nth-of-type(2):before { content: "Founder"; }
            td:nth-of-type(3):before { content: "Total Stock Return"; }
            td:nth-of-type(4):before { content: "Company Name"; }
            td:nth-of-type(5):before { content: "Ticker"; }
            td:nth-of-type(6):before { content: "Industry"; }
            td:nth-of-type(7):before { content: "Sector"; }
            td:nth-of-type(8):before { content: "CEO Compensation"; }
            td:nth-of-type(9):before { content: "Equity Transactions"; }
            td:nth-of-type(10):before { content: "CEO Start Date"; }
            td:nth-of-type(11):before { content: "Start Date Stock Price"; }
            td:nth-of-type(12):before { content: "Stock Price"; }
            td:first-child, td:last-child { border-radius: 0; } /* Remove rounded corners on individual cells for mobile */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section mb-8">
            <h1 class="text-indigo-800 font-extrabold text-6xl tracking-tighter">CEORater</h1>
            <p class="text-gray-600 text-lg">NASDAQ 100 Leadership Performance & Insider Analytics</p>
        </div>

        <div class="nav-tabs">
            <span class="nav-tab active">All CEOs</span>
            <span class="nav-tab">Top Performers</span>
            <span class="nav-tab">Founders</span>
        </div>

        <input type="text" id="searchInput" placeholder="Search by CEO Name, Company, or Industry..." class="search-input">

        <div class="overflow-x-auto">
            <table id="ceoTable" class="min-w-full">
                <thead>
                    <tr>
                        <th data-column="CEO Name">CEO Name</th>
                        <th data-column="Founder (Y/N)">Founder</th>
                        <th data-column="Total Stock Return (TSR) During CEO's Tenure">Total Stock Return</th>
                        <th data-column="Company Name">Company Name</th>
                        <th data-column="Ticker">Ticker</th>
                        <th data-column="Industry">Industry</th>
                        <th data-column="Sector">Sector</th>
                        <th data-column="CEO Compensation ($ millions)">CEO Compensation</th>
                        <th data-column="Equity Transactions">Equity Transactions</th>
                        <th data-column="CEO Start Date">CEO Start Date</th>
                        <th data-column="Start Date Stock Price">Start Date Stock Price</th>
                        <th data-column="Stock Price">Stock Price</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <div class="footer">
            &copy; 2025 CEORater. All rights reserved. Data is provided for analytical purposes only and does not constitute financial advice.
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Supabase Project URL and Public (anon) key
        const supabaseUrl = 'https://qxnljpbxhugsawinluwq.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF4bmxqcGJ4aHVnc2F3aW5sdXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwMTE2NjksImV4cCI6MjA2NTU4NzY2OX0.t1aG1JNeuanoOXKcs4CXLQALmLZiWCbdl9ICH2GVRu0';

        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        let originalData = [];
        let currentData = [];

        const ceoTableBody = document.querySelector('#ceoTable tbody');
        const searchInput = document.getElementById('searchInput');
        const tableHeaders = document.querySelectorAll('#ceoTable th');
        const navTabs = document.querySelectorAll('.nav-tab');

        let sortColumn = null;
        let sortDirection = 'asc'; // 'asc' or 'desc'

        /**
         * Renders the table with the given data.
         * @param {Array<Object>} dataToDisplay - The array of objects to display in the table.
         */
        function renderTable(dataToDisplay) {
            ceoTableBody.innerHTML = ''; // Clear existing rows

            if (dataToDisplay.length === 0) {
                const noResultsRow = ceoTableBody.insertRow();
                const cell = noResultsRow.insertCell();
                cell.colSpan = tableHeaders.length;
                cell.textContent = 'No results found.';
                cell.classList.add('text-center', 'py-4', 'text-gray-500');
                return;
            }

            dataToDisplay.forEach(rowData => {
                const row = ceoTableBody.insertRow();
                // Iterate over the header columns to ensure correct order
                tableHeaders.forEach(header => {
                    const columnKey = header.dataset.column; // Use data-column to get original header name

                    const cell = row.insertCell();
                    let cellContent = rowData[columnKey] || ''; // Handle missing data gracefully

                    // Special formatting based on column
                    if (columnKey === "Founder (Y/N)") {
                        cellContent = cellContent === 'Y' ? 'Yes' : 'No';
                        cell.textContent = cellContent;
                    } else if (columnKey === "Total Stock Return (TSR) During CEO's Tenure") {
                        const rawReturn = parseFloat(String(cellContent).replace('%', '').trim());
                        if (!isNaN(rawReturn)) {
                            cell.textContent = `${rawReturn > 0 ? '+' : ''}${rawReturn.toFixed(0)}%`;
                            if (rawReturn > 0) {
                                cell.classList.add('positive-return');
                            } else if (rawReturn < 0) {
                                cell.classList.add('negative-return');
                            }
                        } else {
                            cell.textContent = cellContent;
                        }
                    } else if (columnKey === "CEO Compensation ($ millions)" ||
                               columnKey === "Start Date Stock Price" ||
                               columnKey === "Stock Price") {
                        // Clean and parse the number, then format as currency
                        const numericValue = parseFloat(String(cellContent).replace(/[\$, ]/g, '').trim());
                        if (!isNaN(numericValue)) {
                            cell.textContent = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                            }).format(numericValue);
                        } else {
                            cell.textContent = cellContent; // Display as is if not a valid number
                        }
                    } else if (columnKey === "Equity Transactions") {
                        if (cellContent && String(cellContent).startsWith('http')) {
                            const link = document.createElement('a');
                            link.href = cellContent;
                            link.textContent = 'View Transactions';
                            link.target = '_blank'; // Open in new tab
                            link.classList.add('link-text');
                            cell.appendChild(link);
                        } else {
                            cell.textContent = cellContent || 'N/A'; // Display N/A if no link
                        }
                    } else {
                        cell.textContent = cellContent;
                    }
                });
            });
        }

        /**
         * Filters the data based on the search input.
         */
        function filterData() {
            const searchTerm = searchInput.value.toLowerCase();
            currentData = originalData.filter(row => {
                // Search across all displayed columns for simplicity
                return Object.values(row).some(value =>
                    String(value).toLowerCase().includes(searchTerm)
                );
            });
            applySort();
        }

        /**
         * Applies the current sort order to the data and re-renders the table.
         */
        function applySort() {
            if (sortColumn) {
                currentData.sort((a, b) => {
                    let valA = a[sortColumn];
                    let valB = b[sortColumn];

                    const cleanString = (val) => String(val || '').trim();

                    // Type-specific sorting logic
                    if (sortColumn === "Total Stock Return (TSR) During CEO's Tenure") {
                        valA = parseFloat(cleanString(valA).replace('%', ''));
                        valB = parseFloat(cleanString(valB).replace('%', ''));
                    } else if (sortColumn === "CEO Compensation ($ millions)" ||
                               sortColumn === "Start Date Stock Price" ||
                               sortColumn === "Stock Price") {
                        valA = parseFloat(cleanString(valA).replace(/[\$, ]/g, ''));
                        valB = parseFloat(cleanString(valB).replace(/[\$, ]/g, ''));
                    } else if (sortColumn === "CEO Start Date") {
                        // Parse dates for correct sorting
                        valA = new Date(cleanString(valA));
                        valB = new Date(cleanString(valB));
                    } else if (sortColumn === "Founder (Y/N)") {
                        valA = (cleanString(valA) === 'Y');
                        valB = (cleanString(valB) === 'Y');
                    } else {
                        // Default to string comparison for other columns
                        valA = cleanString(valA).toLowerCase();
                        valB = cleanString(valB).toLowerCase();
                    }

                    if (typeof valA === 'number' && typeof valB === 'number') {
                        // Handle NaN values during comparison (place them at the end)
                        if (isNaN(valA) && isNaN(valB)) return 0;
                        if (isNaN(valA)) return 1;
                        if (isNaN(valB)) return -1;
                        return sortDirection === 'asc' ? valA - valB : valB - valA;
                    } else if (valA instanceof Date && valB instanceof Date) {
                        // Handle invalid dates (place them at the end)
                        if (isNaN(valA.getTime()) && isNaN(valB.getTime())) return 0;
                        if (isNaN(valA.getTime())) return 1;
                        if (isNaN(valB.getTime())) return -1;
                        return sortDirection === 'asc' ? valA.getTime() - valB.getTime() : valB.getTime() - valA.getTime();
                    } else {
                        // Fallback for string comparison or mixed types
                        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                        return 0;
                    }
                });
            }
            renderTable(currentData);
        }

        /**
         * Handles tab clicks for filtering and sorting data.
         * Currently implements "All CEOs" and a basic sort for "Top Performers" and "Founders".
         * @param {string} tabName - The name of the clicked tab.
         */
        function handleTabClick(tabName) {
            // Remove active class from all tabs
            navTabs.forEach(tab => tab.classList.remove('active'));

            // Add active class to the clicked tab
            // Note: Updated to handle direct text content for tab selection
            let targetTab = Array.from(navTabs).find(tab => tab.textContent === tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }


            let filtered = [...originalData]; // Start with all original data

            if (tabName === "Top Performers") {
                // Sort by TSR descending for Top Performers
                filtered.sort((a, b) => {
                    const tsrA = parseFloat(String(a["Total Stock Return (TSR) During CEO's Tenure"]).replace('%', '').trim());
                    const tsrB = parseFloat(String(b["Total Stock Return (TSR) During CEO's Tenure"]).replace('%', '').trim());
                    if (isNaN(tsrA) && isNaN(tsrB)) return 0;
                    if (isNaN(tsrA)) return 1;
                    if (isNaN(tsrB)) return -1;
                    return tsrB - tsrA; // Descending order
                });
                sortColumn = "Total Stock Return (TSR) During CEO's Tenure";
                sortDirection = 'desc';

            } else if (tabName === "Founders") {
                // Filter to show only founders
                filtered = originalData.filter(row => row["Founder (Y/N)"] === 'Y');
                // Default sort for founders (e.g., by CEO Name)
                sortColumn = "CEO Name";
                sortDirection = 'asc';
            } else { // All CEOs
                sortColumn = null; // Clear sort
                sortDirection = 'asc';
            }
            currentData = filtered; // Update current data with filtered/sorted results
            applySort(); // Re-apply the current sort/render
        }

        /**
         * Fetches data from Supabase and initializes the table.
         */
        async function initSupabase() {
            try {
                const { data, error } = await supabase
                    .from('CEORater Table')
                    .select('*');

                if (error) {
                    console.error('Error fetching data from Supabase:', error.message);
                    ceoTableBody.innerHTML = `<tr><td colspan="${tableHeaders.length}" class="text-center py-4 text-red-500">Error loading data: ${error.message}. Please check your Supabase Row Level Security (RLS) policies for SELECT access.</td></tr>`;
                    return;
                }

                originalData = data;
                // Initialize the "All CEOs" tab as active and render.
                handleTabClick("All CEOs");
            } catch (error) {
                console.error('An unexpected error occurred:', error.message);
                ceoTableBody.innerHTML = `<tr><td colspan="${tableHeaders.length}" class="text-center py-4 text-red-500">An unexpected error occurred: ${error.message}</td></tr>`;
            }
        }

        // Event Listeners
        searchInput.addEventListener('input', filterData);

        // Add click listeners to navigation tabs
        navTabs.forEach(tab => {
            tab.addEventListener('click', (event) => {
                handleTabClick(event.target.textContent);
            });
        });

        tableHeaders.forEach(header => {
            header.addEventListener('click', () => {
                const column = header.dataset.column;
                // Use the exact column name from data-column for sorting
                const actualSortColumn = column;

                if (sortColumn === actualSortColumn) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = actualSortColumn;
                    sortDirection = 'asc';
                }

                // Update header text to show sort indicator
                tableHeaders.forEach(h => {
                    h.innerHTML = h.dataset.column.replace(' (Y/N)', '').replace(' ($ millions)', '').replace(' (TSR) During CEO\'s Tenure', ''); // Reset to original text, clean up display
                    if (h.dataset.column === sortColumn) {
                        h.innerHTML += sortDirection === 'asc' ? ' &#9650;' : ' &#9660;'; // Unicode arrows
                    }
                });
                applySort();
            });
        });

        // Initialize the Supabase connection and fetch data when the page loads
        document.addEventListener('DOMContentLoaded', initSupabase);
    </script>
</body>
</html>
