<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <meta property="og:title" content="CEORater">
    <meta property="og:description" content="NASDAQ 100 CEO Performance & Compensation Analytics">
    <meta property="og:image" content="https://www.ceorater.com/android-chrome-512x512.png">
    <meta property="og:url" content="https://www.ceorater.com/">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEORater</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        #loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-orbitron font-bold italic text-blue-600">CEORater</h1>
            <p class="text-gray-600 mt-2 text-lg">NASDAQ 100 CEO Performance & Compensation Analytics</p>
        </header>

        <main class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <input type="text" id="searchInput"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow lg:col-span-1"
                    placeholder="Search by CEO, Company, or Ticker...">
                <select id="industryFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="">All Industries</option>
                </select>
                <select id="sectorFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="">All Sectors</option>
                </select>
                <select id="sortControl" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="tsrValue-desc">Sort by: TSR (High to Low)</option>
                    <option value="tsrValue-asc">Sort by: TSR (Low to High)</option>
                    <option value="avgAnnualTsr-desc">Sort by: Avg. Annual TSR (High to Low)</option>
                    <option value="avgAnnualTsr-asc">Sort by: Avg. Annual TSR (Low to High)</option>
                    <option value="compensation-desc">Sort by: CEO Compensation (High to Low)</option>
                    <option value="compensation-asc">Sort by: CEO Compensation (Low to High)</option>
                    <option value="tenure-desc">Sort by: Tenure (High to Low)</option>
                    <option value="tenure-asc">Sort by: Tenure (Low to High)</option>
                    <option value="ceo-asc">Sort by: CEO (A-Z)</option>
                    <option value="ceo-desc">Sort by: CEO (Z-A)</option>
                    <option value="company-asc">Sort by: Company (A-Z)</option>
                    <option value="company-desc">Sort by: Company (Z-A)</option>
                </select>
            </div>
            
            <div class="flex justify-end mb-4 space-x-2">
                <button id="downloadExcelButton" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">
                    Export to Excel
                </button>
                <button id="downloadPdfButton" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
                    Download as PDF
                </button>
            </div>
            
            <div id="lastUpdated" class="text-xs text-gray-500 text-right mb-6 h-4"></div>


             <div id="loading" class="flex justify-center items-center h-64">
                <div id="loading-spinner"></div>
            </div>

             <div id="error-message" class="hidden text-center text-red-500 font-medium py-8">
                <p>Could not load data from Google Sheets. Please ensure the sheet is published to the web and the link is correct.</p>
            </div>

            <div>
                <div id="ceoCardView" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                </div>

                <p id="noResults" class="text-center text-gray-500 py-8 hidden">No results found.</p>
            </div>
        </main>
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>TSR is Total Stock Return during CEO tenure. CEORater 2025.</p>
        </footer>
    </div>

    <script>
        // Configuration
        const sheetId = '17k06sKH7b8LETZIpGP7nyCC7fmO912pzJQEx1P538CA';
        const sheetGid = '0';
        // Corrected range to include all required columns up to S
        const range = 'C6:S107'; 
        const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${sheetGid}&range=${range}`;
        const REFRESH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const industryFilter = document.getElementById('industryFilter');
        const sectorFilter = document.getElementById('sectorFilter');
        const sortControl = document.getElementById('sortControl');
        const lastUpdated = document.getElementById('lastUpdated');
        const ceoCardView = document.getElementById('ceoCardView');
        const noResults = document.getElementById('noResults');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');

        // State
        let masterCeoData = [];
        let displayedCeoData = [];
        let currentSort = { key: 'tsrValue', direction: 'desc' };
        
        function parseJSONResponse(text) {
            const jsonString = text.match(/google\.visualization\.Query\.setResponse\((.*)\)/s)[1];
            const data = JSON.parse(jsonString);
            if (!data.table || !data.table.rows) return [];
            
            return data.table.rows.map(row => {
                // Helper to safely get cell value. Defaults to null if not found.
                const getCellVal = (index, property = 'v') => {
                    const cell = row.c[index];
                    if (cell && cell[property] !== null && typeof cell[property] !== 'undefined') {
                        return cell[property];
                    }
                    return null;
                };

                const getNumericVal = (index) => {
                    const cell = row.c[index];
                    if (!cell) return 0;
                    if (typeof cell.v === 'number') return cell.v;
                    let val = cell.v !== null && typeof cell.v !== 'undefined' ? cell.v : cell.f;
                    if (val === null || typeof val === 'undefined' || val === "") return 0;
                    if (typeof val === 'string') {
                        const match = val.match(/^-?\d*\.?\d+/);
                        if (match) val = match[0];
                    }
                    const num = parseFloat(val);
                    return isNaN(num) ? 0 : num;
                };
                
                // Mapping based on the C6:S107 range from the Google Sheet
                return {
                    company: getCellVal(0) || '',
                    ticker: getCellVal(1) || '',
                    industry: getCellVal(2) || '',
                    sector: getCellVal(3) || '',
                    ceo: getCellVal(5) || '',
                    founder: getCellVal(6) || '',
                    compensation: getNumericVal(7),
                    equityTransactions: getCellVal(8) || '',
                    tsrValue: getNumericVal(13),
                    tenure: getNumericVal(14),
                    avgAnnualTsr: getNumericVal(15),
                    compensationCost: getNumericVal(16)
                };
            });
        }

        function formatPercentage(value) {
            if (typeof value !== 'number') return 'N/A';
            return (value * 100).toLocaleString('en-US', { maximumFractionDigits: 0 }) + '%';
        }
        
        /**
         * Formats a number into a currency string in millions with a specified number of decimal places.
         * @param {number} value The number to format.
         * @param {number} decimalPlaces The number of decimal places to show.
         * @returns {string} Formatted currency string.
         */
        function formatMillions(value, decimalPlaces = 2) {
            if (typeof value !== 'number') return 'N/A';
            return value.toLocaleString('en-US', { 
                minimumFractionDigits: decimalPlaces, 
                maximumFractionDigits: decimalPlaces 
            });
        }
        
        // Added function to handle exporting data to a CSV file
        function exportToCsv(filename, data) {
            // Define the headers for your CSV file
            const headers = [
                "CEO", "Company", "Ticker", "Founder", "Tenure (Yrs.)", 
                "TSR", "Avg. Annual TSR", "Compensation ($MM)", 
                "Comp. Cost / 1% Avg. Annual TSR ($MM)", "Industry", "Sector"
            ];
            
            // Convert the array of objects to a CSV string
            const csvRows = [headers.join(',')]; // Start with the header row
            data.forEach(ceo => {
                const values = [
                    `"${ceo.ceo}"`, // Enclose in quotes to handle commas in names
                    `"${ceo.company}"`,
                    ceo.ticker,
                    ceo.founder,
                    ceo.tenure,
                    ceo.tsrValue,
                    ceo.avgAnnualTsr,
                    ceo.compensation,
                    ceo.compensationCost,
                    `"${ceo.industry}"`,
                    `"${ceo.sector}"`
                ];
                csvRows.push(values.join(','));
            });
            
            const csvString = csvRows.join('\n');
            
            // Create a Blob and trigger the download
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename
