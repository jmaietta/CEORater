<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CEORater</title>

  <link rel="canonical" href="https://ceorater.com/">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://get-ceos-test-847610982404.us-east4.run.app" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="dns-prefetch" href="https://get-ceos-test-847610982404.us-east4.run.app">

  <!-- Icons / Manifest -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#0b1220" />

  <!-- Social -->
  <meta property="og:title" content="CEORater" />
  <meta property="og:description" content="NASDAQ 100 CEO Performance & Compensation Analytics" />
  <meta property="og:image" content="https://www.ceorater.com/android-chrome-512x512.png" />
  <meta property="og:url" content="https://www.ceorater.com/" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="CEORater" />
  <meta name="twitter:description" content="NASDAQ 100 CEO Performance & Compensation Analytics" />
  <meta name="twitter:image" content="https://www.ceorater.com/android-chrome-512x512.png" />

  <!-- iOS PWA -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="CEORater" />
  <meta name="format-detection" content="telephone=no" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700&display=swap"></noscript>

  <!-- Tailwind (compiled) -->
  <link rel="preload" href="output.css" as="style" />
  <link rel="stylesheet" href="output.css">

  <style>
    .px-safe { padding-left:max(1rem, env(safe-area-inset-left)); padding-right:max(1rem, env(safe-area-inset-right)); }
    .top-safe { padding-top: env(safe-area-inset-top); }
    .modal { backdrop-filter: saturate(110%) blur(2px); }
    #loading-spinner{ width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}
    /* Account menu */
    .menu { min-width: 220px; }
    .menu a, .menu button { width:100%; text-align:left; }
    .menu [data-danger] { color:#b91c1c; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
  <div class="px-safe">
    <!-- Announcement (optional) -->
    <div id="announcementBar" class="hidden bg-blue-50 text-blue-900">
      <div class="container mx-auto py-2 px-4 text-sm text-center">
        <span class="font-medium">New:</span> Compare CEOs side-by-side — add up to 3 and tap “Compare Now”.
      </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-safe z-30">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between py-3">
          <!-- Left: brand + tabs -->
          <div class="flex items-center gap-3 sm:gap-4">
            <a href="/" class="flex-shrink-0">
              <img src="favicon-32x32.png" alt="CEORater" class="w-8 h-8 rounded" />
            </a>
            <a href="/" class="hidden md:flex items-center gap-x-2">
              <h1 class="text-2xl md:text-3xl font-orbitron italic font-bold text-blue-600">CEORater</h1>
            </a>

            <div class="hidden sm:flex bg-gray-100 rounded-lg p-1 shadow-inner">
              <button id="allCeosTab" class="watchlist-tab px-3 py-1.5 rounded-md text-sm font-medium active">All CEOs</button>
              <button id="watchlistTab" class="watchlist-tab px-3 py-1.5 rounded-md text-sm font-medium flex items-center">
                <span>My Watchlist</span>
                <span id="watchlistCount" class="ml-2 text-xs bg-gray-400 text-white rounded-full px-1.5 py-0.5 hidden">0</span>
              </button>
            </div>
          </div>

          <!-- Right: filters button (mobile) + auth area -->
          <div class="flex items-center gap-2 sm:gap-3">
            <button id="toggleFiltersBtn" class="lg:hidden px-3 py-2 bg-gray-100 rounded-lg hover:bg-gray-200" aria-expanded="false" aria-controls="filtersPanel">
              <span class="sr-only">Toggle filters</span>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h18M3 12h18M3 19h18"/></svg>
            </button>

            <!-- SIGNED OUT: login -->
            <button id="loginBtn" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">Log in</button>

            <!-- SIGNED IN: avatar button + dropdown -->
            <div id="accountWrapper" class="relative hidden">
              <button id="accountMenuBtn"
                      class="w-9 h-9 rounded-full bg-gray-200 flex items-center justify-center focus:outline-none focus:ring focus:ring-blue-500"
                      aria-haspopup="menu" aria-expanded="false" aria-controls="accountMenu" title="Account">
                <span id="avatarInitials" class="text-sm font-semibold text-gray-700">U</span>
              </button>

              <div id="accountMenu"
                   class="menu absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-lg p-2 hidden"
                   role="menu" aria-labelledby="accountMenuBtn">
                <div class="px-3 py-2">
                  <div id="userEmail" class="text-sm font-medium text-gray-800 truncate">user@example.com</div>
                  <div id="userUid" class="text-[11px] text-gray-500 truncate"></div>
                </div>
                <hr class="my-2">

                <button id="settingsBtn" class="px-3 py-2 rounded-md hover:bg-gray-100 text-sm" role="menuitem">
                  Settings
                </button>

                <button id="openDeleteModalBtn" class="mt-1 px-3 py-2 rounded-md hover:bg-red-50 text-sm" data-danger role="menuitem">
                  Delete account…
                </button>

                <button id="logoutBtn" class="mt-1 px-3 py-2 rounded-md hover:bg-gray-100 text-sm" role="menuitem">
                  Log out
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabs on mobile -->
        <div class="container mx-auto px-4 sm:hidden">
          <div class="flex bg-gray-100 rounded-lg p-1 shadow-inner">
            <button id="allCeosTab_m" class="watchlist-tab px-3 py-1.5 rounded-md text-sm font-medium active">All CEOs</button>
            <button id="watchlistTab_m" class="watchlist-tab px-3 py-1.5 rounded-md text-sm font-medium flex items-center">
              <span>My Watchlist</span>
              <span id="watchlistCount_m" class="ml-2 text-xs bg-gray-400 text-white rounded-full px-1.5 py-0.5 hidden">0</span>
            </button>
          </div>
        </div>

        <!-- Filters -->
        <div class="container mx-auto px-4 border-t border-gray-200">
          <div id="filtersPanel" class="hidden lg:block">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 py-3">
              <div>
                <label class="text-xs uppercase tracking-wider text-gray-500">Search</label>
                <input id="searchInput" type="text" placeholder="Search CEOs, companies, or tickers"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
              </div>
              <div>
                <label class="text-xs uppercase tracking-wider text-gray-500">Sector</label>
                <select id="sectorSelect" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All</option>
                  <option>Software</option><option>Semiconductors</option><option>Internet</option>
                  <option>Hardware</option><option>Payments</option><option>Data/Info Services</option>
                </select>
              </div>
              <div>
                <label class="text-xs uppercase tracking-wider text-gray-500">Sort by</label>
                <select id="sortSelect" class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <option value="ceorater_desc">CEO Rater Score (High → Low)</option>
                  <option value="ceorater_asc">CEO Rater Score (Low → High)</option>
                  <option value="tsr_desc">Total Stock Return (High → Low)</option>
                  <option value="tsr_asc">Total Stock Return (Low → High)</option>
                  <option value="comp_desc">Compensation (High → Low)</option>
                  <option value="comp_asc">Compensation (Low → High)</option>
                  <option value="tenure_desc">Tenure (High → Low)</option>
                  <option value="tenure_asc">Tenure (Low → High)</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Stats Row -->
    <section class="container mx-auto px-4 py-4 sm:py-6">
      <div class="grid grid-cols-1 lg:grid-cols-[1fr_auto] gap-4 items-stretch">
        <div class="bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-lg p-4 sm:p-6">
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4">
            <div class="bg-white p-4 rounded-lg shadow text-center stat-card">
              <h3 class="text-sm font-medium text-gray-500">Median Tenure</h3>
              <p id="medianTenureStat" class="text-2xl font-bold text-gray-900 mt-1">--</p>
            </div>

            <div class="bg-white p-4 rounded-lg shadow text-center stat-card">
              <h3 class="text-sm font-medium text-gray-500">Median Alpha Score</h3>
              <p id="medianAlphaScoreStat" class="text-2xl font-bold text-gray-900 mt-1">--</p>
            </div>

            <div class="bg-white p-4 rounded-lg shadow text-center stat-card">
              <h3 class="text-sm font-medium text-gray-500">Median CEO Rater Score</h3>
              <p id="medianCeoRaterScoreStat" class="text-5xl font-orbitron font-black text-slate-800 mb-2">--</p>
              <div class="text-sm text-slate-600 font-medium">60% Alpha • 40% Comp</div>
              <div class="text-xs text-slate-500 mt-1">Comprehensive CEO Performance Rating</div>
            </div>
          </div>
        </div>

        <div class="right-stats grid gap-4">
          <div class="bg-white p-4 rounded-lg shadow text-center stat-card">
            <h3 class="text-sm font-medium text-gray-500">Median Total Stock Return</h3>
            <p id="founderCeoStat" class="text-2xl font-bold text-gray-900 mt-1">--</p>
          </div>

          <div class="bg-white p-4 rounded-lg shadow text-center stat-card">
            <h3 class="text-sm font-medium text-gray-500">Median CEO Compensation</h3>
            <p id="medianCompStat" class="text-2xl font-bold text-gray-900 mt-1">--</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Main content -->
    <main class="container mx-auto px-4 flex-1" role="main">
      <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
        <div id="lastUpdated" class="text-xs text-gray-500 text-right mb-4 h-4"></div>
        <div id="loading" class="flex justify-center items-center h-64"><div id="loading-spinner"></div></div>
        <div id="error-message" class="hidden text-center text-red-500 py-8">Unable to load market data.</div>

        <div>
          <div id="ceoCardView" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
          <p id="noResults" class="hidden text-center text-gray-500 py-8">No results found.</p>
          <div id="watchlistEmpty" class="hidden text-center text-gray-500 py-12">
            <div class="text-4xl mb-4">⭐</div>
            <h3 class="text-lg font-semibold mb-2">Your watchlist is empty</h3>
            <p class="text-sm text-gray-600">Find a CEO and tap the star ★ to add it to your watchlist.</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Detail Modal -->
    <div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative">
        <div id="modalHeader" class="pb-4 border-b"></div>
        <div id="modalBody" class="py-4"></div>
        <div id="modalFooter" class="pt-4 border-t"></div>
        <button id="closeDetailModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Close">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>

    <!-- Comparison Tray -->
    <div id="comparisonTray" class="hidden fixed bottom-0 left-0 right-0 bg-white shadow-2xl border-t border-gray-200 z-40">
      <div class="container mx-auto p-3 text-center sm:p-4 sm:text-left sm:flex sm:justify-between sm:items-center">
        <div class="flex items-center justify-center sm:justify-start space-x-3">
          <span id="comparisonTitle" class="font-semibold text-gray-700">Compare (0/3):</span>
          <div id="trayTickers" class="flex items-center space-x-2"></div>
        </div>
        <button id="compareNowBtn" class="w-full mt-2 sm:w-auto sm:mt-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Compare Now →</button>
      </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
        <div class="p-4 border-b flex justify-between items-center flex-shrink-0">
          <div class="flex items-center gap-x-3">
            <h1 class="text-2xl font-orbitron italic font-bold text-blue-600">CEORater</h1>
            <span class="text-2xl font-light text-gray-300">|</span>
            <h2 class="text-xl font-bold text-gray-800">CEO Comparison</h2>
          </div>
          <button id="closeComparisonModal" class="text-gray-400 hover:text-gray-600" aria-label="Close">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
        <div id="comparisonContent" class="p-4 overflow-y-auto flex-1"></div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 py-8 text-center text-xs text-gray-500">
      <div class="container mx-auto px-4">
        <p>&copy; <span id="year"></span> CEORater. All rights reserved.</p>
        <p class="mt-1">
          <a href="privacy.html" class="underline hover:text-gray-700">Privacy Policy</a> •
          <a href="terms.html" class="underline hover:text-gray-700">Terms</a>
        </p>
      </div>
    </footer>
  </div>

  <!-- Login Modal (existing) -->
  <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" aria-modal="true" role="dialog" aria-labelledby="loginTitle">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
      <div class="p-6">
        <h2 id="loginTitle" class="text-xl font-bold mb-2">Welcome back</h2>
        <p class="text-sm text-gray-600 mb-4">Sign in to manage your watchlist and compare CEOs.</p>

        <div class="space-y-3">
          <button id="googleLogin" class="w-full flex items-center justify-center gap-2 border rounded-lg px-4 py-2 hover:bg-gray-50">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5 h-5" alt="">
            Continue with Google
          </button>

          <button id="microsoftLogin" class="w-full flex items-center justify-center gap-2 border rounded-lg px-4 py-2 hover:bg-gray-50">
            <img src="https://img.icons8.com/fluency/48/microsoft.png" class="w-5 h-5" alt="">
            Continue with Microsoft
          </button>
        </div>

        <div class="py-3 text-center text-xs text-gray-400">or</div>

        <form id="emailLoginForm" class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input id="emailInput" type="email" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input id="passwordInput" type="password" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>

          <button id="emailLoginSubmit" type="submit" class="w-full bg-blue-600 text-white rounded-lg py-2 hover:bg-blue-700">Sign In</button>

          <div class="flex items-center justify-between text-xs">
            <button type="button" id="showSignUp" class="underline">Create account</button>
            <button type="button" id="forgotPasswordBtn" class="underline">Forgot password?</button>
          </div>
        </form>

        <form id="emailSignUpForm" class="space-y-3 hidden mt-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input id="signUpEmailInput" type="email" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input id="signUpPasswordInput" type="password" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>

          <button id="emailSignUpSubmit" type="submit" class="w-full bg-blue-600 text-white rounded-lg py-2 hover:bg-blue-700">Create Account</button>

          <div class="text-xs text-gray-600">
            By creating an account you agree to our <a href="terms.html" class="underline">Terms</a> and <a href="privacy.html" class="underline">Privacy</a>.
          </div>

          <div class="text-xs text-gray-500 mt-1">
            Already have an account? <button type="button" id="showLogin" class="underline">Sign in</button>
          </div>
        </form>
      </div>
      <div class="p-4 border-t flex justify-end">
        <button id="closeLoginModal" class="border rounded-lg px-4 py-2 hover:bg-gray-50">Close</button>
      </div>
    </div>
  </div>

  <!-- Delete Account Modal (existing logic handled in delete-account.js) -->
  <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal z-50 flex items-center justify-center p-4" aria-modal="true" role="dialog" aria-labelledby="deleteTitle">
    <div class="bg-white rounded-lg p-6 w-full max-w-md relative">
      <h2 id="deleteTitle" class="text-xl font-bold mb-2 text-red-600">Delete Account</h2>
      <div class="mb-4 p-3 border rounded-md">
        <p class="font-medium"><span aria-hidden="true">⚠️</span> Warning: This action cannot be undone</p>
        <ul class="list-disc list-inside text-sm mt-2 text-gray-600">
          <li>Permanently remove your watchlist</li>
          <li>Delete all your saved preferences</li>
          <li>Remove your account credentials</li>
        </ul>
      </div>

      <label class="block text-sm font-medium text-gray-700 mb-1">Confirm your password (if asked)</label>
      <input id="deletePassword" type="password" placeholder="Password"
             class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 mb-4" />

      <div class="flex justify-end gap-2">
        <button id="cancelDeleteBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
        <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Delete</button>
      </div>

      <button id="closeDeleteModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600" aria-label="Close">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

  <!-- App config/init -->
  <script defer src="firebase-config.js"></script>
  <script defer src="firebase-init.js"></script>

  <!-- Your existing modules -->
  <script type="module" src="ui.js"></script>
  <script type="module" src="auth.js"></script>

  <!-- Account Menu & nav behavior -->
  <script type="module" src="script.js"></script>

  <!-- Delete Account logic (calls backend purge + user.delete) -->
  <script type="module" src="delete-account.js"></script>

  <!-- Service Worker (skip in Capacitor/iOS webview) -->
  <script>
    (function() {
      const isCapacitor = !!(window.Capacitor && typeof window.Capacitor.getPlatform === 'function' && window.Capacitor.getPlatform() !== 'web');
      if (!isCapacitor && 'serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          (window.requestIdleCallback || function(cb){setTimeout(cb,0);})(() => {
            navigator.serviceWorker.register('service-worker.js')
              .then(reg => console.log('SW registration ok:', reg.scope))
              .catch(err => console.log('SW registration failed:', err));
          });
        });
      }
    })();
  </script>
</body>
</html>
