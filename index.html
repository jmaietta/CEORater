<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <meta property="og:title" content="CEORater">
    <meta property="og:description" content="NASDAQ 100 CEO Performance & Compensation Analytics">
    <meta property="og:image" content="https://www.ceorater.com/android-chrome-512x512.png">
    <meta property="og:url" content="https://www.ceorater.com/">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEORater</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        #loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-orbitron font-bold italic text-blue-600">CEORater</h1>
            <p class="text-gray-600 mt-2 text-lg">NASDAQ 100 CEO Performance & Compensation Analytics</p>
        </header>

        <main class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <input type="text" id="searchInput"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow lg:col-span-1"
                    placeholder="Search by CEO, Company, or Ticker...">
                <select id="industryFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="">All Industries</option>
                </select>
                <select id="sectorFilter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="">All Sectors</option>
                </select>
                <select id="sortControl" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                    <option value="tsrValue-desc">Sort by: TSR (High to Low)</option>
                    <option value="tsrValue-asc">Sort by: TSR (Low to High)</option>
                    <option value="avgAnnualTsr-desc">Sort by: Avg. Annual TSR (High to Low)</option>
                    <option value="avgAnnualTsr-asc">Sort by: Avg. Annual TSR (Low to High)</option>
                    <option value="compensation-desc">Sort by: CEO Compensation (High to Low)</option>
                    <option value="compensation-asc">Sort by: CEO Compensation (Low to High)</option>
                    <option value="tenure-desc">Sort by: Tenure (High to Low)</option>
                    <option value="tenure-asc">Sort by: Tenure (Low to High)</option>
                    <option value="ceo-asc">Sort by: CEO (A-Z)</option>
                    <option value="ceo-desc">Sort by: CEO (Z-A)</option>
                    <option value="company-asc">Sort by: Company (A-Z)</option>
                    <option value="company-desc">Sort by: Company (Z-A)</option>
                </select>
            </div>
            
            <div class="flex justify-end mb-4 space-x-2">
                <button id="downloadExcelButton" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition">
                    Export to Excel
                </button>
            </div>
            
            <div id="lastUpdated" class="text-xs text-gray-500 text-right mb-6 h-4"></div>


             <div id="loading" class="flex justify-center items-center h-64">
                <div id="loading-spinner"></div>
            </div>

             <div id="error-message" class="hidden text-center text-red-500 font-medium py-8">
                <p>Could not load data from Google Sheets. Please ensure the sheet is published to the web and the link is correct.</p>
            </div>

            <div>
                <div id="ceoCardView" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                </div>

                <p id="noResults" class="text-center text-gray-500 py-8 hidden">No results found.</p>
            </div>
        </main>
        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>CEORater 2025. A TEK2day Holdings company.</p>
        </footer>
    </div>

    <script>
        // Configuration
        const sheetId = '17k06sKH7b8LETZIpGP7nyCC7fmO912pzJQEx1P538CA';
        const sheetGid = '0';
        const range = 'C6:S107'; 
        const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${sheetGid}&range=${range}`;
        const REFRESH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const industryFilter = document.getElementById('industryFilter');
        const sectorFilter = document.getElementById('sectorFilter');
        const sortControl = document.getElementById('sortControl');
        const lastUpdated = document.getElementById('lastUpdated');
        const ceoCardView = document.getElementById('ceoCardView');
        const noResults = document.getElementById('noResults');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');

        // State
        let masterCeoData = [];
        let displayedCeoData = [];
        let currentSort = { key: 'tsrValue', direction: 'desc' };
        
        function parseJSONResponse(text) {
            const match = text.match(/google\.visualization\.Query\.setResponse\((.*)\)/s);
            if (!match || !match[1]) {
                console.error("Could not parse JSON response from Google Sheets.");
                return [];
            }
            const jsonString = match[1];
            const data = JSON.parse(jsonString);
            if (!data.table || !data.table.rows) return [];
            
            return data.table.rows.map(row => {
                const getCellVal = (index, property = 'v') => {
                    const cell = row.c[index];
                    if (cell && cell[property] !== null && typeof cell[property] !== 'undefined') {
                        return cell[property];
                    }
                    return null;
                };

                const getNumericVal = (index) => {
                    const cell = row.c[index];
                    if (!cell) return 0;
                    if (typeof cell.v === 'number') return cell.v;
                    let val = cell.v !== null && typeof cell.v !== 'undefined' ? cell.v : cell.f;
                    if (val === null || typeof val === 'undefined' || val === "") return 0;
                    if (typeof val === 'string') {
                        const match = val.match(/^-?\d*\.?\d+/);
                        if (match) val = match[0];
                    }
                    const num = parseFloat(val);
                    return isNaN(num) ? 0 : num;
                };
                
                return {
                    company: getCellVal(0) || '',
                    ticker: getCellVal(1) || '',
                    industry: getCellVal(2) || '',
                    sector: getCellVal(3) || '',
                    ceo: getCellVal(5) || '',
                    founder: getCellVal(6) || '',
                    compensation: getNumericVal(7),
                    equityTransactions: getCellVal(8) || '',
                    tsrValue: getNumericVal(13),
                    tenure: getNumericVal(14),
                    avgAnnualTsr: getNumericVal(15),
                    compensationCost: getNumericVal(16)
                };
            });
        }

        function formatPercentage(value) {
            if (typeof value !== 'number') return 'N/A';
            return (value * 100).toLocaleString('en-US', { maximumFractionDigits: 0 }) + '%';
        }
        
        function formatMillions(value, decimalPlaces = 2) {
            if (typeof value !== 'number') return 'N/A';
            return value.toLocaleString('en-US', { 
                minimumFractionDigits: decimalPlaces, 
                maximumFractionDigits: decimalPlaces 
            });
        }
        
        function exportToCsv(filename, data) {
            const title = '"CEORater"';
            const tagline = '"NASDAQ 100 CEO Performance & Compensation Analytics"';
            
            const headers = [
                "CEO", "Company", "Ticker", "Founder", "Tenure (Yrs.)", 
                "Total Stock Return (TSR)", "Avg. Annual TSR", "CEO Compensation ($MM)", 
                "Comp. Cost / 1% Avg. Annual TSR ($MM)", "Industry", "Sector"
            ];
            
            const dataRows = data.map(ceo => {
                const values = [
                    `"${String(ceo.ceo || '').replace(/"/g, '""')}"`,
                    `"${String(ceo.company || '').replace(/"/g, '""')}"`,
                    ceo.ticker,
                    ceo.founder,
                    ceo.tenure.toFixed(1),
                    `"${formatPercentage(ceo.tsrValue)}"`,
                    `"${formatPercentage(ceo.avgAnnualTsr)}"`,
                    `"$${formatMillions(ceo.compensation, 1)}"`,
                    `"$${formatMillions(ceo.compensationCost, 3)}"`,
                    `"${String(ceo.industry || '').replace(/"/g, '""')}"`,
                    `"${String(ceo.sector || '').replace(/"/g, '""')}"`
                ];
                return values.join(',');
            });
            
            const csvString = [title, tagline, '', headers.join(',')].concat(dataRows).join('\n');
            
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function displayData(data) {
            ceoCardView.innerHTML = '';
            if (data.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');
            renderCards(data);
        }
        
        function renderCards(data) {
            data.forEach(ceo => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-lg p-4 shadow-sm flex flex-col justify-between';
                
                const founderBadge = ceo.founder && ceo.founder.toUpperCase() === 'Y' 
                    ? `<span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Founder</span>` : '';

                const filingsLink = ceo.equityTransactions
                    ? `<a href="${ceo.equityTransactions}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 hover:underline">View Filings</a>` : `<span class="text-gray-400">N/A</span>`;
                
                const tsrTextColor = ceo.tsrValue >= 0 ? 'text-green-600' : 'text-red-600';
                const avgTsrTextColor = ceo.avgAnnualTsr >= 0 ? 'text-green-600' : 'text-red-600';

                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-lg text-gray-900">${ceo.ceo}${founderBadge}</h3>
                                <p class="text-sm text-gray-600">${ceo.company} (${ceo.ticker})</p>
                            </div>
                        </div>
                        <div class="mt-4 space-y-2">
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">Total Stock Return (TSR) During CEO's Tenure</span><span class="font-bold ${tsrTextColor}">${formatPercentage(ceo.tsrValue)}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">Avg. Annual TSR</span><span class="font-bold ${avgTsrTextColor}">${formatPercentage(ceo.avgAnnualTsr)}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">CEO Compensation ($MM)</span><span class="text-gray-700 text-right">$${formatMillions(ceo.compensation, 1)}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500 text-left">Comp. Cost / 1% Avg. Annual TSR ($MM)</span><span class="text-gray-700 text-right">$${formatMillions(ceo.compensationCost, 3)}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">Tenure (Yrs.)</span><span class="text-gray-700 text-right">${ceo.tenure.toFixed(1)}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">Industry</span><span class="text-gray-700 text-right">${ceo.industry || 'N/A'}</span></div>
                            <div class="flex justify-between text-sm"><span class="font-medium text-gray-500">Sector</span><span class="text-gray-700 text-right">${ceo.sector || 'N/A'}</span></div>
                        </div>
                    </div>
                    <div class="flex justify-between text-sm items-center pt-3 mt-3 border-t">
                        <span class="font-medium text-gray-500">Equity Transactions</span>
                        <span>${filingsLink}</span>
                    </div>
                `;
                ceoCardView.appendChild(card);
            });
        }

        function sortData() {
            const { key, direction } = currentSort;
            displayedCeoData.sort((a, b) => {
                const valA = a[key];
                const valB = b[key];
                let comparison = 0;
                if (typeof valA === 'number' && typeof valB === 'number') {
                    comparison = valA - valB;
                } else {
                    comparison = String(valA || '').localeCompare(String(valB || ''), 'en', { sensitivity: 'base' });
                }
                return direction === 'asc' ? comparison : -comparison;
            });
            displayData(displayedCeoData);
        }
        
        function handleSortChange(e) {
            const [key, direction] = e.target.value.split('-');
            if (key && direction) {
                currentSort = { key, direction };
                sortData();
            }
        }

        function filterAndSortData() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedIndustry = industryFilter.value;
            const selectedSector = sectorFilter.value;

            displayedCeoData = masterCeoData.filter(ceo => {
                const searchMatch = (ceo.ceo.toLowerCase().includes(searchTerm)) ||
                       (ceo.company.toLowerCase().includes(searchTerm)) ||
                       (ceo.ticker.toLowerCase().includes(searchTerm));
                const industryMatch = !selectedIndustry || ceo.industry === selectedIndustry;
                const sectorMatch = !selectedSector || ceo.sector === selectedSector;
                return searchMatch && industryMatch && sectorMatch;
            });
            sortData();
        }

        function populateFilters(data) {
            const industries = [...new Set(data.map(ceo => ceo.industry).filter(Boolean))].sort();
            const sectors = [...new Set(data.map(ceo => ceo.sector).filter(Boolean))].sort();

            industryFilter.innerHTML = '<option value="">All Industries</option>';
            industries.forEach(industry => {
                const option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                industryFilter.appendChild(option);
            });

            sectorFilter.innerHTML = '<option value="">All Sectors</option>';
            sectors.forEach(sector => {
                const option = document.createElement('option');
                option.value = sector;
                option.textContent = sector;
                sectorFilter.appendChild(option);
            });
        }
        
        async function fetchAndUpdateData(isInitialLoad = false) {
             try {
                const response = await fetch(`${sheetUrl}&t=${new Date().getTime()}`); // Cache-busting
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const responseText = await response.text();
                masterCeoData = parseJSONResponse(responseText);

                if (masterCeoData.length === 0) {
                   if (isInitialLoad) throw new Error("No data parsed from the sheet.");
                   return;
                }
                
                if (isInitialLoad) {
                    populateFilters(masterCeoData);
                }
                
                filterAndSortData();
                
                const now = new Date();
                lastUpdated.textContent = `Last updated: ${now.toLocaleTimeString()}`;

            } catch (error) {
                console.error("Error fetching or processing data: ", error);
                if (isInitialLoad) errorMessage.classList.remove('hidden');
            } finally {
                if (isInitialLoad) loading.style.display = 'none';
            }
        }

        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        async function init() {
            await fetchAndUpdateData(true);
            searchInput.addEventListener('input', debounce(filterAndSortData, 300));
            industryFilter.addEventListener('change', filterAndSortData);
            sectorFilter.addEventListener('change', filterAndSortData);
            sortControl.addEventListener('change', handleSortChange);
            setInterval(() => fetchAndUpdateData(false), REFRESH_INTERVAL_MS);

            const downloadExcelButton = document.getElementById('downloadExcelButton');
            downloadExcelButton.addEventListener('click', () => {
                exportToCsv('CEORater_Data.csv', displayedCeoData);
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
