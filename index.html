<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEORater</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EQ3DR3D21X"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EQ3DR3D21X');
    </script>
    <!-- Favicon: "CR" from logo, rendered as SVG text -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><style>text{font-family:Orbitron, sans-serif;font-weight:900;font-style:italic;fill:%232b396b;}</style><text x=%225%22 y=%2275%22 font-size=%2270%22>CR</text></svg>">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Orbitron -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for better aesthetics and responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Lighter background like the image */
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            padding: 2rem;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 1280px; /* Wider container */
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.05); /* Lighter shadow */
            padding: 2.5rem 3rem; /* More generous padding */
        }

        /* Header Styling */
        .header-section h1 {
            color: #2b396b; /* Dark blue from the logo */
            font-size: 3.5rem; /* Larger font for logo */
            font-weight: 800; /* Extra bold */
            letter-spacing: -0.05em; /* Tighter letter spacing */
            line-height: 1;
            margin-bottom: 0.5rem;
            font-family: 'Orbitron', sans-serif; /* Apply Orbitron font */
            font-style: italic; /* Apply italics */
        }
        .header-section p {
            color: #64748b; /* Grey for subtitle */
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0; /* Underline for tabs */
            padding-bottom: 0.5rem;
        }
        .nav-tab {
            padding: 0.5rem 1rem;
            font-weight: 600;
            cursor: pointer;
            color: #64748b; /* Inactive tab color */
            transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            border-bottom: 2px solid transparent; /* Placeholder for active underline */
        }
        .nav-tab.active {
            color: #4f46e5; /* Active tab color (indigo) */
            border-color: #4f46e5; /* Active tab underline */
        }
        .nav-tab:hover {
            color: #4f46e5;
        }

        /* Table specific styles */
        table {
            border-collapse: separate; /* Allows for rounded corners on cells */
            border-spacing: 0 0.5rem; /* Space between rows */
            border-radius: 0.75rem; /* Apply to container for overall rounded look */
            overflow: hidden; /* Important for rounded corners to show */
            background-color: transparent; /* Table background handled by container */
        }
        thead {
            background-color: #f8fafc; /* Light header background */
            color: #64748b; /* Header text color */
            font-weight: 600;
            font-size: 0.875rem; /* Smaller header font */
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        th {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: none; /* No border for headers in this design */
            cursor: pointer;
            position: relative; /* For positioning sort icons */
        }
        /* Specific column width adjustments */
        th[data-column="CEO Name"] { min-width: 150px; }
        th[data-column="Total Stock Return (TSR) During CEO's Tenure"] { min-width: 170px; } /* Wider TSR column */
        th[data-column="Company Name"] { min-width: 150px; }
        th[data-column="Ticker"] { min-width: 80px; }
        th[data-column="Industry"] { min-width: 180px; }
        th[data-column="Sector"] { min-width: 150px; }
        /* Removed specific width for CEO Compensation as it's hidden */
        th[data-column="Equity Transactions"] { min-width: 120px; }


        /* Sort indicator styles */
        .sort-indicator {
            position: absolute;
            right: 0.75rem; /* Position to the right of padding */
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            line-height: 0.8; /* Adjust line height for icon spacing */
        }
        .sort-indicator span {
            font-size: 0.7em; /* Smaller arrow size */
            opacity: 0.2; /* Subtle when not sorted */
            transition: opacity 0.2s ease-in-out, color 0.2s ease-in-out;
            color: #64748b; /* Default arrow color */
        }
        th:hover .sort-indicator span {
            opacity: 0.5; /* More visible on hover */
        }
        th.asc .asc-arrow,
        th.desc .desc-arrow {
            opacity: 1; /* Fully visible for active sort arrow */
            color: #4f46e5; /* Active arrow color */
        }
        th.asc .desc-arrow,
        th.desc .asc-arrow {
            opacity: 0.2; /* Keep inactive arrow subtle */
        }

        tbody tr {
            background-color: #ffffff;
            border-radius: 0.75rem; /* Rounded corners for each row */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); /* Subtle shadow for rows */
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }
        tbody tr:hover {
            transform: translateY(-2px); /* Slight lift on hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        td {
            padding: 1rem 1.5rem;
            border-bottom: none; /* No internal borders in this design */
            vertical-align: middle;
        }
        td:first-child { border-top-left-radius: 0.75rem; border-bottom-left-radius: 0.75rem; }
        td:last-child { border-top-right-radius: 0.75rem; border-bottom-right-radius: 0.75rem; }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .search-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            outline: none;
        }
        .positive-return {
            color: #16a34a; /* Darker green for returns */
            font-weight: bold;
        }
        .negative-return {
            color: #dc2626; /* Darker red for returns */
            font-weight: bold;
        }
        .founder-badge {
            display: inline-block;
            background-color: #fcd34d; /* Yellowish background */
            color: #78350f; /* Dark brown text */
            padding: 0.15rem 0.4rem; /* Slightly smaller padding for badge */
            border-radius: 0.5rem;
            font-size: 0.7rem; /* Smaller font for badge */
            font-weight: 600;
            margin-top: 0.25rem; /* Space below CEO name */
            white-space: nowrap;
        }
        .ceo-info-cell {
            display: flex;
            flex-direction: column; /* Stack CEO name and badge/company */
            align-items: flex-start; /* Align text to left */
        }
        .ceo-name-line {
            font-semibold;
            text-gray-900;
            display: flex; /* Allow badge to sit next to or below CEO name */
            align-items: center; /* Vertically align badge with name */
            gap: 0.5rem; /* Space between name and badge */
        }
        .company-info-line {
            text-sm;
            text-gray-500;
            margin-top: 0.2rem; /* Small space between CEO and company info */
        }
        .link-text {
            color: #4f46e5; /* Indigo for links */
            text-decoration: none;
            font-weight: 500;
        }
        .link-text:hover {
            text-decoration: underline;
        }
        .icon-arrow {
            width: 1.25rem;
            height: 1.25rem;
            vertical-align: middle;
            fill: none;
            stroke: #64748b;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: transform 0.2s ease-in-out;
        }
        .footer {
            text-align: center;
            margin-top: 3rem;
            font-size: 0.875rem;
            color: #64748b;
        }

        /* Scroll shadow styles */
        .overflow-x-auto {
            position: relative; /* Needed for absolute positioning of pseudo-elements */
            overflow-x: auto; /* Enable horizontal scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #cbd5e0 transparent; /* Firefox */
        }
        /* Webkit scrollbar styles */
        .overflow-x-auto::-webkit-scrollbar {
            height: 8px; /* height of horizontal scrollbar */
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background-color: #cbd5e0; /* Color of the scroll thumb */
            border-radius: 4px; /* Roundness of the scroll thumb */
        }
        .overflow-x-auto::-webkit-scrollbar-track {
            background-color: transparent; /* Color of the scrollbar track */
        }


        .overflow-x-auto::before,
        .overflow-x-auto::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 30px; /* Width of the shadow fade */
            pointer-events: none; /* Allows clicks/interactions through the shadow */
            transition: opacity 0.3s ease-in-out; /* Smooth transition for shadows */
            z-index: 10; /* Ensure shadows are above table content but below header */
        }

        .overflow-x-auto::before {
            left: 0;
            background: linear-gradient(to right, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 100%);
            opacity: 0; /* Initially hidden */
        }

        .overflow-x-auto::after {
            right: 0;
            background: linear-gradient(to left, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0) 100%);
            opacity: 1; /* Initially visible */
        }

        /* Classes controlled by JavaScript to show/hide shadows */
        .overflow-x-auto.no-left-shadow::before {
            opacity: 0;
        }
        .overflow-x-auto.has-left-shadow::before {
            opacity: 1;
        }
        .overflow-x-auto.no-right-shadow::after {
            opacity: 0;
        }
        .overflow-x-auto.has-right-shadow::after {
            opacity: 1;
        }


        /* Responsive table behavior */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }
            .header-section h1 {
                font-size: 2.5rem;
            }
            .header-section p {
                font-size: 0.9rem;
            }
            .nav-tabs {
                gap: 0.5rem;
            }
            .nav-tab {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute; /* Hide original headers for mobile */
                top: -9999px;
                left: -9999px;
            }
            tbody tr {
                margin-bottom: 1rem;
            }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
            }
            /* Label the data - Adjusted for hidden columns */
            td:nth-of-type(1):before { content: "CEO Name"; }
            td:nth-of-type(2):before { content: "Total Stock Return During CEO's Tenure"; }
            td:nth-of-type(3):before { content: "Company Name"; }
            td:nth-of-type(4):before { content: "Ticker"; }
            td:nth-of-type(5):before { content: "Industry"; }
            td:nth-of-type(6):before { content: "Sector"; }
            td:nth-of-type(7):before { content: "Equity Transactions"; } /* Shifted from 8th to 7th */
            /* CEO Start Date, Start Date Stock Price, Stock Price are hidden */
            td:first-child, td:last-child { border-radius: 0; } /* Remove rounded corners on individual cells for mobile */

            /* Hide scroll shadows on mobile as native scrollbars are more prominent */
            .overflow-x-auto::before,
            .overflow-x-auto::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section mb-8">
            <h1 class="text-indigo-800 font-extrabold text-6xl tracking-tighter">CEORater</h1>
            <p class="text-gray-600 text-lg font-bold">NASDAQ 100 Leadership Performance & Insider Analytics</p>
        </div>

        <div class="nav-tabs">
            <span class="nav-tab active">All CEOs</span>
            <span class="nav-tab">Top Performers</span>
            <span class="nav-tab">Founders</span>
        </div>

        <input type="text" id="searchInput" placeholder="Search by CEO Name, Company, or Industry..." class="search-input">

        <div class="overflow-x-auto" id="tableContainer">
            <table id="ceoTable" class="min-w-full">
                <thead>
                    <tr>
                        <th data-column="CEO Name">
                            CEO Name
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <th data-column="Total Stock Return (TSR) During CEO's Tenure">
                            Total Stock Return During CEO's Tenure
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <th data-column="Company Name">
                            Company Name
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <th data-column="Ticker">
                            Ticker
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <th data-column="Industry">
                            Industry
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <th data-column="Sector">
                            Sector
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <!-- Hidden CEO Compensation column -->
                        <!-- <th data-column="CEO Compensation ($ millions)">
                            CEO Compensation
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th> -->
                        <th data-column="Equity Transactions">
                            Equity Transactions
                            <span class="sort-indicator">
                                <span class="asc-arrow">&#9650;</span>
                                <span class="desc-arrow">&#9660;</span>
                            </span>
                        </th>
                        <!-- These columns are now hidden from the display -->
                        <!-- <th data-column="CEO Start Date">CEO Start Date</th> -->
                        <!-- <th data-column="Start Date Stock Price">Start Date Stock Price</th> -->
                        <!-- <th data-column="Stock Price">Stock Price</th> -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <div class="footer">
            &copy; 2025 CEORater. All rights reserved. Data is provided for analytical purposes only and does not constitute financial advice.
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Supabase Project URL and Public (anon) key
        const supabaseUrl = 'https://qxnljpbxhugsawinluwq.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF4bmxqcGJ4aHVnc2F3aW5sdXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwMTE2NjksImV4cCI6MjA2NTU4NzY2OX0.t1aG1JNeuanoOXKcs4CXLQALmLZiWCbdl9ICH2GVRu0';

        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        let originalData = [];
        let currentData = [];

        const ceoTableBody = document.querySelector('#ceoTable tbody');
        const searchInput = document.getElementById('searchInput');
        const tableHeaders = Array.from(document.querySelectorAll('#ceoTable th'));
        const navTabs = document.querySelectorAll('.nav-tab');
        const tableContainer = document.getElementById('tableContainer');

        let sortColumn = null;
        let sortDirection = 'asc'; // 'asc' or 'desc'

        /**
         * Renders the table with the given data.
         * @param {Array<Object>} dataToDisplay - The array of objects to display in the table.
         */
        function renderTable(dataToDisplay) {
            ceoTableBody.innerHTML = '';

            if (dataToDisplay.length === 0) {
                const noResultsRow = ceoTableBody.insertRow();
                const cell = noResultsRow.insertCell();
                cell.colSpan = tableHeaders.length;
                cell.textContent = 'No results found.';
                cell.classList.add('text-center', 'py-4', 'text-gray-500');
                return;
            }

            dataToDisplay.forEach(rowData => {
                const row = ceoTableBody.insertRow();
                tableHeaders.forEach(headerElement => {
                    const columnKey = headerElement.dataset.column;
                    const cell = row.insertCell();
                    let cellContent = rowData[columnKey] || '';

                    if (columnKey === "CEO Name") {
                        const ceoNameDiv = document.createElement('div');
                        ceoNameDiv.classList.add('font-semibold', 'text-gray-900');
                        ceoNameDiv.textContent = cellContent;
                        cell.appendChild(ceoNameDiv);

                        if (rowData["Founder (Y/N)"] === 'Y') {
                            const founderBadge = document.createElement('span');
                            founderBadge.classList.add('founder-badge');
                            founderBadge.textContent = 'Founder';
                            const badgeContainer = document.createElement('div');
                            badgeContainer.appendChild(founderBadge);
                            cell.appendChild(badgeContainer);
                        }
                    } else if (columnKey === "Total Stock Return (TSR) During CEO's Tenure") {
                        const rawReturn = parseFloat(String(cellContent).replace('%', '').trim());
                        if (!isNaN(rawReturn)) {
                            cell.textContent = `${rawReturn > 0 ? '+' : ''}${rawReturn.toFixed(0)}%`;
                            if (rawReturn > 0) {
                                cell.classList.add('positive-return');
                            } else if (rawReturn < 0) {
                                cell.classList.add('negative-return');
                            }
                        } else {
                            cell.textContent = cellContent;
                        }
                    } else if (columnKey === "CEO Compensation ($ millions)") {
                        // This column is hidden from the display, so this block will not execute
                        // during rendering, but the data is still fetched.
                        const compensationValue = String(cellContent).replace(/[\$, ]/g, '').trim();
                        const numericCompensation = parseFloat(compensationValue);
                        if (!isNaN(numericCompensation) && compensationValue !== "") {
                            cell.textContent = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                minimumFractionDigits: 1,
                                maximumFractionDigits: 1
                            }).format(numericCompensation) + ' MM';
                        } else {
                            cell.textContent = 'N/A';
                        }
                    } else if (columnKey === "Equity Transactions") {
                        if (cellContent && String(cellContent).startsWith('http')) {
                            const link = document.createElement('a');
                            link.href = cellContent;
                            link.textContent = 'View Filings';
                            link.target = '_blank';
                            link.classList.add('link-text');
                            cell.appendChild(link);
                        } else {
                            cell.textContent = cellContent || 'N/A';
                        }
                    } else if (columnKey === "Stock Price" || columnKey === "Start Date Stock Price") {
                         const numericValue = parseFloat(String(cellContent).replace(/[\$, ]/g, '').trim());
                        if (!isNaN(numericValue)) {
                            cell.textContent = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                            }).format(numericValue);
                        } else {
                            cell.textContent = cellContent;
                        }
                    }
                    else {
                        cell.textContent = cellContent;
                    }
                });
            });
            updateScrollShadows();
        }

        /**
         * Filters the data based on the search input.
         */
        function filterData() {
            const searchTerm = searchInput.value.toLowerCase();
            currentData = originalData.filter(row => {
                return Object.values(row).some(value =>
                    String(value).toLowerCase().includes(searchTerm)
                );
            });
            applySort();
        }

        /**
         * Applies the current sort order to the data and re-renders the table.
         */
        function applySort() {
            if (sortColumn) {
                currentData.sort((a, b) => {
                    let valA = a[sortColumn];
                    let valB = b[sortColumn];

                    const cleanString = (val) => String(val || '').trim();

                    if (sortColumn === "Total Stock Return (TSR) During CEO's Tenure") {
                        valA = parseFloat(cleanString(valA).replace('%', ''));
                        valB = parseFloat(cleanString(valB).replace('%', ''));
                    } else if (sortColumn === "CEO Compensation ($ millions)" ||
                               sortColumn === "Start Date Stock Price" ||
                               sortColumn === "Stock Price") {
                        valA = parseFloat(cleanString(valA).replace(/[\$, ]/g, ''));
                        valB = parseFloat(cleanString(valB).replace(/[\$, ]/g, ''));
                    } else if (sortColumn === "CEO Start Date") {
                        valA = new Date(cleanString(valA));
                        valB = new Date(cleanString(valB));
                    } else if (sortColumn === "Founder (Y/N)") {
                        valA = (cleanString(valA) === 'Y');
                        valB = (cleanString(valB) === 'Y');
                    } else {
                        valA = cleanString(valA).toLowerCase();
                        valB = cleanString(valB).toLowerCase();
                    }

                    if (typeof valA === 'number' && typeof valB === 'number') {
                        if (isNaN(valA) && isNaN(valB)) return 0;
                        if (isNaN(valA)) return 1;
                        if (isNaN(valB)) return -1;
                        return sortDirection === 'asc' ? valA - valB : valB - valA;
                    } else if (valA instanceof Date && valB instanceof Date) {
                        if (isNaN(valA.getTime()) && isNaN(valB.getTime())) return 0;
                        if (isNaN(valA.getTime())) return 1;
                        if (isNaN(valB.getTime())) return -1;
                        return sortDirection === 'asc' ? valA.getTime() - valB.getTime() : valB.getTime() - valA.getTime();
                    } else {
                        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
                        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
                        return 0;
                    }
                });
            }
            renderTable(currentData);
        }

        /**
         * Handles tab clicks for filtering and sorting data.
         * @param {string} tabName - The name of the clicked tab.
         */
        function handleTabClick(tabName) {
            navTabs.forEach(tab => tab.classList.remove('active'));

            let targetTab = Array.from(navTabs).find(tab => tab.textContent === tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }

            let filtered = [...originalData];

            if (tabName === "Top Performers") {
                filtered.sort((a, b) => {
                    const tsrA = parseFloat(String(a["Total Stock Return (TSR) During CEO's Tenure"]).replace('%', '').trim());
                    const tsrB = parseFloat(String(b["Total Stock Return (TSR) During CEO's Tenure"]).replace('%', '').trim());
                    if (isNaN(tsrA) && isNaN(tsrB)) return 0;
                    if (isNaN(tsrA)) return 1;
                    if (isNaN(tsrB)) return -1;
                    return tsrB - tsrA;
                });
                sortColumn = "Total Stock Return (TSR) During CEO's Tenure";
                sortDirection = 'desc';

            } else if (tabName === "Founders") {
                filtered = originalData.filter(row => row["Founder (Y/N)"] === 'Y');
                sortColumn = "CEO Name";
                sortDirection = 'asc';
            } else { // All CEOs
                sortColumn = null;
                sortDirection = 'asc';
            }
            currentData = filtered;
            applySort();
        }

        /**
         * Updates the visibility of scroll shadows based on scroll position.
         */
        function updateScrollShadows() {
            if (!tableContainer) return;

            const { scrollWidth, clientWidth, scrollLeft } = tableContainer;
            const scrollable = scrollWidth > clientWidth;

            const atLeftEnd = scrollLeft === 0;
            const atRightEnd = (scrollLeft + clientWidth) >= scrollWidth;

            if (scrollable) {
                if (atLeftEnd) {
                    tableContainer.classList.remove('has-left-shadow');
                    tableContainer.classList.add('no-left-shadow');
                } else {
                    tableContainer.classList.add('has-left-shadow');
                    tableContainer.classList.remove('no-left-shadow');
                }

                if (atRightEnd) {
                    tableContainer.classList.remove('has-right-shadow');
                    tableContainer.classList.add('no-right-shadow');
                } else {
                    tableContainer.classList.add('has-right-shadow');
                    tableContainer.classList.remove('no-right-shadow');
                }
            } else {
                tableContainer.classList.remove('has-left-shadow', 'has-right-shadow');
                tableContainer.classList.add('no-left-shadow', 'no-right-shadow');
            }
        }


        /**
         * Fetches data from Supabase and initializes the table.
         */
        async function initSupabase() {
            try {
                const { data, error } = await supabase
                    .from('CEORater Table')
                    .select('*');

                if (error) {
                    console.error('Error fetching data from Supabase:', error.message);
                    ceoTableBody.innerHTML = `<tr><td colspan="${tableHeaders.length}" class="text-center py-4 text-red-500">Error loading data: ${error.message}. Please check your Supabase Row Level Security (RLS) policies for SELECT access.</td></tr>`;
                    return;
                }

                originalData = data;
                handleTabClick("All CEOs");
                updateScrollShadows();
            } catch (error) {
                console.error('An unexpected error occurred:', error.message);
                ceoTableBody.innerHTML = `<tr><td colspan="${tableHeaders.length}" class="text-center py-4 text-red-500">An unexpected error occurred: ${error.message}</td></tr>`;
            }
        }

        // Event Listeners
        searchInput.addEventListener('input', filterData);

        navTabs.forEach(tab => {
            tab.addEventListener('click', (event) => {
                handleTabClick(event.target.textContent);
            });
        });

        tableHeaders.forEach(header => {
            header.addEventListener('click', (event) => {
                const column = header.dataset.column;
                const actualSortColumn = column;

                // Reset all headers' sort indicators
                tableHeaders.forEach(h => {
                    h.classList.remove('asc', 'desc');
                });

                if (sortColumn === actualSortColumn) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = actualSortColumn;
                    sortDirection = 'asc';
                }

                // Add active sort class to the current header
                header.classList.add(sortDirection);
                applySort();
            });
        });

        tableContainer.addEventListener('scroll', updateScrollShadows);

        document.addEventListener('DOMContentLoaded', () => {
            initSupabase();
            window.addEventListener('resize', updateScrollShadows);
        });
    </script>
</body>
</html>
